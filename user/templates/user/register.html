<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>注册</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-1.12.4.js" type="text/javascript"></script>
    <style>
        .account {
            width: 400px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="account">
        <h1>注册</h1>
        <form>
            {% for field in form %}
                {% ifequal field.name 'code' %}
                    <div class="form-group">
                        <label for="{{ field.id_for_label }}">{{ field.label }}</label> :
                        <div class="clearfix">
                        <div class="col-md-6" style="padding-left: 0">{{ field }}</div>
                        <div class="col-md-6">
                            <input type="button" id="button_code" class="btn btn-default" value="点击获取验证码">
                        </div>
                        </div>
                    </div>
                    <div class="errmsg" id="{{ field.name }}_errmsg" style="{display: none;color: red;}"></div>
                {% else %}
                    <div class="form-group">
                        <label for="{{ field.id_for_label }}">{{ field.label }}</label> : {{ field }}
                    </div>
                    <div class="errmsg" id="{{ field.name }}_errmsg" style="{display: none;color: red;}" ></div>
                {% endifequal %}
             {% endfor %}
            <button type="submit" class="btn btn-primary">注册</button>
        </form>
    </div>
</body>
</html>
<script type="text/javascript">
    // 绑定全部input框
    $('input').on('focus', function () {
        $('.errmsg').css('display', 'none')
    })

    // 获取验证码
    $('#button_code').on('click', function () {

        varmobile = $('#mobile_phpne_errmsg').prev().children('input').val()

        if (varmobile != ""){
            var that = $(this)
            $.post('/user/send', {'mobile': varmobile, 'tpl': 'register'}, function (data) {

                if (data.result == '0')
                {
                    var timeo = 60;
                    var timeStop = setInterval(function () {
                        timeo--;
                        if (timeo > 0) {
                            that.val('重新发送' + timeo + 's');
                            that.attr('disabled', 'disabled');//禁止点击
                        } else {
                            timeo = 60;//当减到0时赋值为60
                            that.val('点击获取验证码');
                            clearInterval(timeStop);//清除定时器
                            that.removeAttr('disabled');//移除属性，可点击
                        }
                    }, 1000)
                    filed = '#' + data.filed + '_errmsg'
                    $('.errmsg').css('display', 'none')
                    $(filed).css('display', 'block').html(data.errmsg).css('color', 'green')
                 }
                else
                {
                    filed = '#' + data.filed + '_errmsg'
                    $('.errmsg').css('display', 'none')
                    $(filed).css('display', 'block').html(data.errmsg).css('color', 'red')
                }
            })

         }
        else
        {
            $('.errmsg').css('display', 'none')
            $('#mobile_phpne_errmsg').css('display', 'block').html('请先输入手机号').css('color', 'red')
         }
    })

    // 注册
    $('.btn-primary').on('click', function (event) {
        event.preventDefault();
        var data = $('form').serializeArray();
        $.post('/user/register', data, function (res) {
            // 返回结果
            var filed = '#' + res.filed + '_errmsg'
            $('.errmsg').css('display', 'none')
            $(filed).css('display', 'block').html(res.errmsg).css('color', 'red')
        })
    })

</script>